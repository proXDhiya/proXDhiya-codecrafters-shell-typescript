#!/usr/bin/env sh

# Sums a list of integers (supports positive and negative numbers)
# Usage: calc 1 -2 3

sum=0

if [ "$#" -eq 0 ]; then
  echo "calc: missing operands" >&2
  exit 1
fi

expr=$(printf "%s" "$*" | tr -d ' ')

awk -v s="$expr" 'BEGIN {
  if (s !~ /^[-+]?[0-9]+([+-][0-9]+)*$/) {
    print "calc: invalid expression" > "/dev/stderr";
    exit 1;
  }

  total = 0;
  i = 1;
  sign = 1;

  first = substr(s, 1, 1);
  if (first == "+") {
    i = 2;
  } else if (first == "-") {
    sign = -1;
    i = 2;
  }

  while (i <= length(s)) {
    j = i;
    while (j <= length(s) && substr(s, j, 1) ~ /[0-9]/) {
      j++;
    }
    num = substr(s, i, j - i) + 0;
    total += sign * num;

    if (j > length(s)) {
      break;
    }

    op = substr(s, j, 1);
    sign = (op == "-") ? -1 : 1;
    i = j + 1;
  }

  print total;
}'
